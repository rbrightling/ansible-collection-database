---
# defaults file for postgresql

# Postgresql Version to install and use
postgresql_version: 17

# Create template databases.
postgresql_templates: []
# - name: (template_ prefix to name)
#   lc_collate: (default: postgresql_database_lc_collate)
#   lc_ctype: (default: postgresql_database_lc_collate)
#   encoding: (default: postgresql_database_encoding)
#   template: (default: template0)
#   owner: (default: postgresql__system_user)
#   state: (default: present)
#   extensions: [] (optional)

postgresql_databases: []
# - name: 
#   lc_collate: (default: postgresql_database_lc_collate)
#   lc_ctype: (default: postgresql_database_lc_collate)
#   encoding: (default: postgresql_database_encoding)
#   template: (default: template1)
#   owner: (default: postgresql__system_user)
#   state: (default: present)
#   extensions: [] (optional)
#   schema: (optional)
#     name:
#     state: (default: present)

postgresql_users: []
# - name:
#   password:
#   state: (default: present)

postgresql_privs: []
# - login_db: 
#   roles: 
#   type: 
#   obj: (optional)
#   privs: (optional)
#   schema: (optional)
#   grant_option: (optional)
#   target_roles: (optional)
#   state: (default: present)

# Login options for postgresql modules
postgresql_login_host: null
postgresql_login_password: null
postgresql_login_user: null
postgresql_login_unix_socket: null
postgresql_login_port: null

postgresql_users_no_log: false

postgresql_database_lc_collate: "en_GB.UTF-8"
postgresql_database_lc_ctype: "en_GB.UTF-8"
postgresql_database_encoding: "UTF-8"
postgresql_database_template: 'template1'

# Main Configuration
#
# FILE LOCATION
postgresql_conf_directory: "/etc/postgresql/{{ postgresql_version }}/main"
postgresql_data_directory: "/var/lib/postgresql/{{ postgresql_version }}/main"
postgresql_hba_file: "{{ postgresql_conf_directory }}/pg_hba.conf"
postgresql_ident_file: "{{ postgresql_conf_directory }}/pg_ident.conf"
postgresql_external_pid_file: "/var/run/postgresql/{{ postgresql_version }}-main.pid"

# CONNECTIONS AND AUTHENTICATION
postgresql_listen_addresses: "localhost"
postgresql_port: 5432

postgresql_max_connections: 100

postgresql_superuser_reserved_connections: null

postgresql_unix_socket_directories: "/var/run/postgresql"
postgresql_unix_socket_group: null
postgresql_unix_socket_permissions: "0770"

postgresql_bonjour: false
postgresql_bonjour_name: null

postgresql_tcp_keepalives_idle: 300
postgresql_tcp_keepalives_interval: 30
postgresql_tcp_keepalives_count: 5
postgresql_tcp_user_timeout: 30000
postgresql_client_connection_check_interval: 60

# Authentication
postgresql_authentication_timeout: 20s
postgresql_password_encryption: scram-sha-256
postgresql_db_user_namespace: false

# GSSAPI using Kerberos                                                                                                                                                                                                             [664/933]
postgresql_krb_server_keyfile: null
postgresql_krb_caseins_users: null

# SSL
postgresql_ssl: true
postgresql_ssl_ca_file: null                                                                                                                                                                                                                           
postgresql_ssl_cert_file: '/etc/ssl/certs/ssl-cert-snakeoil.pem'
postgresql_ssl_crl_file: null           
postgresql_ssl_crl_dir: null             
postgresql_ssl_key_file: '/etc/ssl/private/ssl-cert-snakeoil.key'
postgresql_ssl_ciphers: 'HIGH:!aNULL:!MD5'
postgresql_ssl_prefer_server_ciphers: true
postgresql_ssl_ecdh_curve: 'prime256v1'
postgresql_ssl_min_protocol_version: 'TLSv1.3'
postgresql_ssl_max_protocol_version: null
postgresql_ssl_dh_params_file: null                                                                                                                                                                                                                     
postgresql_ssl_passphrase_command: null                                                                                                                                                                                                                
postgresql_ssl_passphrase_command_supports_reload: null

# Based on 2GB by default
postgresql_shared_buffers: 400MB
postgresql_huge_pages: try
postgresql_huge_page_size: 0
postgresql_temp_buffers: 8MB
postgresql_max_prepared_transactions: 0
postgresql_work_mem: 8MB
postgresql_hash_mem_multiplier: 2.0
postgresql_maintenance_work_mem: 64MB
postgresql_autovacuum_work_mem: -1
postgresql_logical_decoding_work_mem: 64MB
postgresql_max_stack_depth: 2MB
postgresql_shared_memory_type: mmap
postgresql_dynamic_shared_memory_type: posix
postgresql_min_dynamic_shared_memory: 0MB

# - Disk -                                         
postgresql_temp_file_limit: 1GB
# - Kernel Resources -                            
postgresql_max_files_per_process: 1000
# - Cost-Based Vacuum Delay -                      
postgresql_vacuum_cost_delay: 10
postgresql_vacuum_cost_page_hit: null
postgresql_vacuum_cost_page_miss: null
postgresql_vacuum_cost_page_dirty: null
postgresql_vacuum_cost_limit: null

# - Background Writer -
postgresql_bgwriter_delay:  null
postgresql_bgwriter_lru_maxpages: null
postgresql_bgwriter_lru_multiplier:  null
postgresql_bgwriter_flush_after: 1MB

# - Asynchronous Behavior -
postgresql_backend_flush_after: 256kB
postgresql_effective_io_concurrency: 4
postgresql_maintenance_io_concurrency: null
postgresql_max_worker_processes: null
postgresql_max_parallel_workers_per_gather: null
postgresql_max_parallel_maintenance_workers: null
postgresql_max_parallel_workers: null
postgresql_parallel_leader_participation: null 

postgresql_old_snapshot_threshold: null
# - Settings -
postgresql_wal_level: replica
postgresql_fsync: true
postgresql_synchronous_commit: true
postgresql_wal_sync_method: fdatasync
postgresql_full_page_writes: on
postgresql_wal_log_hints: off
postgresql_wal_compression: lz4
postgresql_wal_init_zero: on                     # zero-fill new WAL files
postgresql_wal_recycle: on                       # recycle WAL files
postgresql_wal_buffers: -1                       # min 32kB, -1 sets based on shared_buffers
postgresql_wal_writer_delay: 200ms               # 1-10000 milliseconds
postgresql_wal_writer_flush_after: 1MB           # measured in pages, 0 disables
postgresql_wal_skip_threshold: 2MB
postgresql_commit_delay: 0                       # range 0-100000, in microseconds
postgresql_commit_siblings: 5                    # range 1-1000

# - Checkpoints -                                                                                                                                                                                                                            
postgresql_checkpoint_timeout: 10min              # range 30s-1d                                                                                                                                                                                       
postgresql_checkpoint_completion_target: 0.9     # checkpoint target duration, 0.0 - 1.0                                                                                                                                                              
postgresql_checkpoint_flush_after: 256kB         # measured in pages, 0 disables                                                                                                                                                                      
postgresql_checkpoint_warning: 30s               # 0 disables                                                                                                                                                                                         
postgresql_max_wal_size: 2GB                                                                                                                                                                                                                           
postgresql_min_wal_size: 80MB       

# - Prefetching during recovery -                                                                                     
postgresql_recovery_prefetch:  null               # prefetch pages referenced in the WAL?                                       
postgresql_wal_decode_buffer_size: null         # lookahead window used for prefetching                                       

# - Archiving -
postgresql_archive_mode: false            # enables archiving; off, on, or always
postgresql_archive_library: null           # library to use to archive a logfile segment
postgresql_archive_command: null           # command to use to archive a logfile segment
postgresql_archive_timeout: null            # force a logfile segment switch after this

# - Archive Recovery -
postgresql_restore_command: null           # command to use to restore an archived logfile segment
postgresql_archive_cleanup_command: null   # command to execute at every restartpoint
postgresql_recovery_end_command: null      # command to execute at completion of recovery

# - Recovery Target -
postgresql_recovery_target: null           # 'immediate' to end recovery as soon as a
postgresql_recovery_target_name: null      # the named restore point to which recovery will proceed
postgresql_recovery_target_time: null      # the time stamp up to which recovery will proceed
postgresql_recovery_target_xid: null       # the transaction ID up to which recovery will proceed
postgresql_recovery_target_lsn: null       # the WAL LSN up to which recovery will proceed
postgresql_recovery_target_inclusive: null # Specifies whether to stop:
postgresql_recovery_target_timeline: null    # 'current', 'latest', or timeline ID
postgresql_recovery_target_action: null       # 'pause', 'promote', 'shutdown'

# REPLICATION

# - Sending Servers -
postgresql_max_wal_senders: 3          # max number of walsender processes
postgresql_max_replication_slots:  2    # max number of replication slots
postgresql_wal_keep_size: 256              # in megabytes; 0 disables
postgresql_max_slot_wal_keep_size: 1024   # in megabytes; -1 disables
postgresql_wal_sender_timeout: null       # in milliseconds; 0 disables
postgresql_track_commit_timestamp: null  # collect timestamp of transaction commit

# - Primary Server -
postgresql_synchronous_standby_names: null # standby servers that provide sync rep
postgresql_vacuum_defer_cleanup_age: null   # number of xacts by which cleanup is delayed

# - Standby Servers -
postgresql_primary_conninfo: null                  # connection string to sending server
postgresql_primary_slot_name: null                 # replication slot on sending server
postgresql_promote_trigger_file: null              # file name whose presence ends recovery
postgresql_hot_standby: null                       # "off" disallows queries during recovery
postgresql_max_standby_archive_delay: null        # max delay before canceling queries
postgresql_max_standby_streaming_delay: null      # max delay before canceling queries
postgresql_wal_receiver_create_temp_slot: null    # create temp slot if primary_slot_name
postgresql_wal_receiver_status_interval: null     # send replies at least this often
postgresql_hot_standby_feedback: null             # send info from standby to prevent
postgresql_wal_receiver_timeout: null             # time that receiver waits for
postgresql_wal_retrieve_retry_interval: null       # time to wait before retrying to
postgresql_recovery_min_apply_delay: null           # minimum delay for applying changes during recovery

# - Subscribers -

postgresql_max_logical_replication_workers: null     # taken from max_worker_processes
postgresql_max_sync_workers_per_subscription: null  # taken from max_logical_replication_workers

# QUERY TUNING

# - Planner Method Configuration -

postgresql_enable_async_append: null
postgresql_enable_bitmapscan: null
postgresql_enable_gathermerge: null
postgresql_enable_hashagg: null
postgresql_enable_hashjoin: null
postgresql_enable_incremental_sort: null
postgresql_enable_indexscan: null
postgresql_enable_indexonlyscan: null
postgresql_enable_material: null
postgresql_enable_memoize: null
postgresql_enable_mergejoin: null
postgresql_enable_nestloop: null
postgresql_enable_parallel_append: null
postgresql_enable_parallel_hash: null
postgresql_enable_partition_pruning: null
postgresql_enable_partitionwise_join: null
postgresql_enable_partitionwise_aggregate: null
postgresql_enable_seqscan: null
postgresql_enable_sort: null
postgresql_enable_tidscan: null

# - Planner Cost Constants -

postgresql_seq_page_cost: null                    # measured on an arbitrary scale
postgresql_random_page_cost: 2.0                 # same scale as above
postgresql_cpu_tuple_cost:  null                 # same scale as above
postgresql_cpu_index_tuple_cost: null           # same scale as above
postgresql_cpu_operator_cost: null             # same scale as above
postgresql_parallel_setup_cost: null   # same scale as above
postgresql_parallel_tuple_cost: null              # same scale as above
postgresql_min_parallel_table_scan_size: null 
postgresql_min_parallel_index_scan_size: null 
postgresql_effective_cache_size: null
postgresql_jit_above_cost: null # perform JIT compilation if available
postgresql_jit_inline_above_cost: null # inline small functions if query is
postgresql_jit_optimize_above_cost: null # use expensive JIT optimizations if

# - Genetic Query Optimizer -

postgresql_geqo: null
postgresql_geqo_threshold: null 
postgresql_geqo_effort: null                       # range 1-10
postgresql_geqo_pool_size: null                     # selects default based on effort
postgresql_geqo_generations: null                   # selects default based on effort
postgresql_geqo_selection_bias: null              # range 1.5-2.0
postgresql_geqo_seed: null                        # range 0.0-1.0
# - Other Planner Options -
postgresql_default_statistics_target: null
postgresql_constraint_exclusion: null
postgresql_cursor_tuple_fraction: null
postgresql_from_collapse_limit: null
postgresql_jit: null
postgresql_join_collapse_limit: null
postgresql_plan_cache_mode: null
postgresql_recursive_worktable_factor: null

# REPORTING AND LOGGING

# - Where to Log -
postgresql_log_destination: 'stderr'             # Valid values are combinations of
postgresql_logging_collector: true  # Enable capturing of stderr, jsonlog,
postgresql_log_directory: '/var/log/postgresql'                  # directory where log files are written,
postgresql_log_filename: 'postgresql-%Y-%m-%d.log'        # log file name pattern,
postgresql_log_file_mode: "0600"                   # creation mode for log files,
postgresql_log_rotation_age: 1d                  # Automatic rotation of logfiles will
postgresql_log_rotation_size: 10MB               # Automatic rotation of logfiles will
postgresql_log_truncate_on_rotation: true         # If on, an existing log file with the
postgresql_syslog_facility: null
postgresql_syslog_ident: null
postgresql_syslog_sequence_numbers: null
postgresql_syslog_split_messages: null
postgresql_event_source: null

# - When to Log -
postgresql_log_min_messages: warning 
postgresql_log_min_error_statement: error        # values in order of decreasing detail:
postgresql_log_min_duration_statement: 500        # -1 is disabled, 0 logs all statements
postgresql_log_min_duration_sample: null           # -1 is disabled, 0 logs a sample of statements
postgresql_log_statement_sample_rate: null        # fraction of logged statements exceeding
postgresql_log_transaction_sample_rate: null      # fraction of transactions whose statements
postgresql_log_startup_progress_interval: null


  # - What to Log -

postgresql_debug_print_parse: off
postgresql_debug_print_rewritten: off
postgresql_debug_print_plan: off
postgresql_debug_pretty_print: on
postgresql_log_autovacuum_min_duration: 1min    # log autovacuum activity;
postgresql_log_checkpoints: on
postgresql_log_connections: on
postgresql_log_disconnections: on
postgresql_log_duration: off
postgresql_log_error_verbosity: verbose # terse, default, or verbose messages
postgresql_log_hostname: off
postgresql_log_line_prefix: '%m [%p]: db=%d,user=%u,app=%a,client=%h '            # special values:
postgresql_log_lock_waits: on                  # log lock waits >= deadlock_timeout
postgresql_log_recovery_conflict_waits: null      # log standby recovery conflict waits
postgresql_log_parameter_max_length: -1          # when logging statements, limit logged
postgresql_log_parameter_max_length_on_error: -1  # when logging an error, limit logged
postgresql_log_statement: ddl # none, ddl, mod, all
postgresql_log_replication_commands: null
postgresql_log_temp_files: 1024                   # log temporary files equal or larger
postgresql_log_timezone: 'UTC'


postgresql_cluster_name: '{{ ansible_fqdn }}'                        # added to process titles if nonempty
postgresql_update_process_title: null

#------------------------------------------------------------------------------
# STATISTICS
#------------------------------------------------------------------------------

# - Cumulative Query and Index Statistics -

postgresql_track_activities: null
postgresql_track_activity_query_size: null # (change requires restart)
postgresql_track_counts: null
postgresql_track_io_timing: null
postgresql_track_wal_io_timing: null
postgresql_track_functions: null                # none, pl, all
postgresql_stats_fetch_consistency: null


# - Monitoring -

postgresql_compute_query_id: null
postgresql_log_statement_stats: null
postgresql_log_parser_stats: null
postgresql_log_planner_stats: null
postgresql_log_executor_stats: null


#------------------------------------------------------------------------------
# AUTOVACUUM
#------------------------------------------------------------------------------

postgresql_autovacuum: true                        # Enable autovacuum subprocess?  'on'
postgresql_autovacuum_max_workers: null             # max number of autovacuum subprocesses
postgresql_autovacuum_naptime: null             # time between autovacuum runs
postgresql_autovacuum_vacuum_threshold: null       # min number of row updates before
postgresql_autovacuum_vacuum_insert_threshold: null      # min number of row inserts
postgresql_autovacuum_analyze_threshold: null      # min number of row updates before
postgresql_autovacuum_vacuum_scale_factor: null   # fraction of table size before vacuum
postgresql_autovacuum_vacuum_insert_scale_factor: null    # fraction of inserts over table
postgresql_autovacuum_analyze_scale_factor: null  # fraction of table size before analyze
postgresql_autovacuum_freeze_max_age: null # maximum XID age before forced vacuum
postgresql_autovacuum_multixact_freeze_max_age: null # maximum multixact age
postgresql_autovacuum_vacuum_cost_delay: null     # default vacuum cost delay for
postgresql_autovacuum_vacuum_cost_limit: null      # default vacuum cost limit for

#------------------------------------------------------------------------------
# CLIENT CONNECTION DEFAULTS
#------------------------------------------------------------------------------

# - Statement Behavior -

postgresql_client_min_messages: null # values in order of decreasing detail:
postgresql_search_path: null        # schema names
postgresql_row_security: null
postgresql_default_table_access_method: null
postgresql_default_tablespace: null               # a tablespace name, '' uses the default
postgresql_default_toast_compression: null     # 'pglz' or 'lz4'
postgresql_temp_tablespaces: null                  # a list of tablespace names, '' uses
postgresql_check_function_bodies: null 
postgresql_default_transaction_isolation: null
postgresql_default_transaction_read_only: null
postgresql_default_transaction_deferrable: null
postgresql_session_replication_role: null
postgresql_statement_timeout: null
postgresql_lock_timeout: null
postgresql_idle_in_transaction_session_timeout: null
postgresql_idle_session_timeout: null
postgresql_vacuum_freeze_table_age: null
postgresql_vacuum_freeze_min_age: null
postgresql_vacuum_failsafe_age: null
postgresql_vacuum_multixact_freeze_table_age: null
postgresql_vacuum_multixact_freeze_min_age: null
postgresql_vacuum_multixact_failsafe_age: null
postgresql_bytea_output: null
postgresql_xmlbinary: null
postgresql_xmloption: null
postgresql_gin_pending_list_limit: null

# - Locale and Formatting -

postgresql_datestyle: null
postgresql_intervalstyle: null
postgresql_timezone: 'UTC'
postgresql_timezone_abbreviations: null
postgresql_extra_float_digits: null                 # min -15, max 3; any value >0 actually
postgresql_client_encoding: null # actually, defaults to database
# These settings are initialized by initdb, but they can be changed.
postgresql_lc_messages: 'C.UTF-8'                 # locale for system error message
postgresql_lc_monetary: 'C.UTF-8'                 # locale for monetary formatting
postgresql_lc_numeric: 'C.UTF-8'                  # locale for number formatting
postgresql_lc_time: 'C.UTF-8'                             # locale for time formatting
# default configuration for text search
postgresql_default_text_search_config: 'pg_catalog.english'
# - Shared Library Preloading -

postgresql_local_preload_libraries: null
postgresql_session_preload_libraries: null
postgresql_shared_preload_libraries: null
postgresql_jit_provider: null

# - Other Defaults -

postgresql_dynamic_library_path: null
postgresql_extension_destdir: null
postgresql_gin_fuzzy_search_limit: null

#------------------------------------------------------------------------------
# LOCK MANAGEMENT
#------------------------------------------------------------------------------

postgresql_deadlock_timeout: null
postgresql_max_locks_per_transaction: null
postgresql_max_pred_locks_per_transaction: null
postgresql_max_pred_locks_per_relation: null
postgresql_max_pred_locks_per_page: null

#------------------------------------------------------------------------------
# VERSION AND PLATFORM COMPATIBILITY
#------------------------------------------------------------------------------

# - Previous PostgreSQL Versions -
postgresql_array_nulls: null
postgresql_backslash_quote: null # on, off, or safe_encoding
postgresql_escape_string_warning: null
postgresql_lo_compat_privileges: null
postgresql_quote_all_identifiers: null
postgresql_standard_conforming_strings: null
postgresql_synchronize_seqscans: null
# - Other Platforms and Clients -
postgresql_transform_null_equals: null


#------------------------------------------------------------------------------
# ERROR HANDLING
#------------------------------------------------------------------------------
postgresql_exit_on_error: false
postgresql_restart_after_crash: true
postgresql_data_sync_retry: false
postgresql_recovery_init_sync_method: "{{ postgresql__recovery_init_sync_method|default('fsync') }}"
#------------------------------------------------------------------------------
# CONFIG FILE INCLUDES
#------------------------------------------------------------------------------
# These options allow settings to be loaded from files other than the
# default postgresql.conf.  Note that these are directives, not variable
# assignments, so they can usefully be given more than once.

postgresql_include_dir: 'conf.d'                  # include files ending in '.conf' from
postgresql_include_if_exists: null              # include file only if it exists
postgresql_include:  null   


# HBA Permissions

postgresql_hba_authentication: []
# - type:
#   database: 
#   user: 
#   address: (optional)
#   method:
#
postgresql_hba_allow_local_socket_connection: true
postgresql_hba_allow_local_ipv4_connection: false
postgresql_hba_allow_local_ipv6_connection: false
postgresql_hba_allow_local_replication: false

# PG Ident
postgresql_ident_mapping: []
# - mapname:
#   system_username:
#   pg_username:

# start.conf
postgresql_cluster_start: auto

# pg_ctl.conf
postgresql_ctl_option: ""

# createcluster.conf  
postgresql_initdb_options: "--data-checksums --locale={{ postgresql_database_lc_collate}}"

# Program umask
postgresql_umask: "0077"


# Modules
# -------
postgresql_enable_module_credcheck: true
postgresql_enable_module_pgaudit: true
postgresql_enable_module_set_user: true

# PGAudit
postgresql_pgaudit_log: 'write, ddl, role'
postgresql_pgaudit_log_catalog: false
postgresql_pgaudit_log_client: null
postgresql_pgaudit_log_level: null
postgresql_pgaudit_log_parameter: null
postgresql_pgaudit_log_parameter_max_size: null
postgresql_pgaudit_log_relation: null
postgresql_pgaudit_log_rows: null
postgresql_pgaudit_log_statement: null
postgresql_pgaudit_log_statement_once: null
postgresql_pgaudit_role: null

# Credcheck
postgresql_credcheck_username_min_length: 6
postgresql_credcheck_username_min_special: null
postgresql_credcheck_username_min_digit: null
postgresql_credcheck_username_min_upper: null
postgresql_credcheck_username_min_lower: null
postgresql_credcheck_username_min_repeat: null
postgresql_credcheck_username_contain_password: null
postgresql_credcheck_username_contain: null
postgresql_credcheck_username_not_contain: null
postgresql_credcheck_username_ignore_case: null
postgresql_credcheck_password_min_length: 14
postgresql_credcheck_password_min_special: 1
postgresql_credcheck_password_min_digit: 1
postgresql_credcheck_password_min_upper: 1
postgresql_credcheck_password_min_lower: 1
postgresql_credcheck_password_min_repeat: 3
postgresql_credcheck_password_contain_username: true
postgresql_credcheck_password_contain: null
postgresql_credcheck_password_not_contain: null
postgresql_credcheck_password_ignore_case: null
postgresql_credcheck_password_valid_until: null
postgresql_credcheck_password_valid_max: null
postgresql_credcheck_whitelist: null
postgresql_credcheck_password_reuse_history: 5
postgresql_credcheck_password_reuse_interval: 365
postgresql_credcheck_max_auth_failure: null
postgresql_credcheck_reset_superuser: null
postgresql_credcheck_whitelist_auth_failure: null
postgresql_credcheck_auth_delay_ms: 500

# Set User
postgresql_set_user_block_alter_system: null
postgresql_set_user_block_copy_program: null
postgresql_set_user_block_log_statement: null
postgresql_set_user_superuser_allowlist: null
postgresql_set_user_nosuperuser_target_allowlist: null
postgresql_set_user_exit_on_error: null
